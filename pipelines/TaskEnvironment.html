<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Task Environment Variables - Gopherbot DevOps Chatbot</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../Title.html">Title</a></li><li class="chapter-item expanded affix "><a href="../Status.html">Status</a></li><li class="chapter-item expanded affix "><a href="../Foreword.html">Foreword</a></li><li class="chapter-item expanded affix "><a href="../Introduction.html">Introduction</a></li><li class="chapter-item expanded affix "><a href="../Terminology.html">Terminology</a></li><li class="chapter-item expanded affix "><li class="part-title">Part I - Getting Started</li><li class="chapter-item expanded "><a href="../botdev/IDE.html"><strong aria-hidden="true">1.</strong> The Gopherbot IDE</a></li><li class="chapter-item expanded "><a href="../Installation.html"><strong aria-hidden="true">2.</strong> Installing and Configuring a Gopherbot Robot</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../install/LinuxInstall.html"><strong aria-hidden="true">2.1.</strong> Installation on Linux</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../install/Requirements.html"><strong aria-hidden="true">2.1.1.</strong> Software Requirements</a></li><li class="chapter-item expanded "><a href="../install/ManualInstall.html"><strong aria-hidden="true">2.1.2.</strong> Installing Gopherbot</a></li></ol></li><li class="chapter-item expanded "><a href="../botsetup/credentials.html"><strong aria-hidden="true">2.2.</strong> Team Chat Credentials</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../botsetup/slacksock.html"><strong aria-hidden="true">2.2.1.</strong> Slack Socket Mode</a></li></ol></li><li class="chapter-item expanded "><a href="../RobotSetup.html"><strong aria-hidden="true">2.3.</strong> Initial Robot Setup</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../botsetup/Requirements.html"><strong aria-hidden="true">2.3.1.</strong> Environment Requirements</a></li><li class="chapter-item expanded "><a href="../botsetup/gopherhome.html"><strong aria-hidden="true">2.3.2.</strong> Robot Directory Structure</a></li><li class="chapter-item expanded "><a href="../botsetup/Plugin.html"><strong aria-hidden="true">2.3.3.</strong> Quick Start with the Gopherbot IDE</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../RunRobot.html"><strong aria-hidden="true">3.</strong> Deploying and Running Your Robot</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../deploy/deploy-environment.html"><strong aria-hidden="true">3.1.</strong> Deployment Environment Variables</a></li><li class="chapter-item expanded "><a href="../deploy/Container.html"><strong aria-hidden="true">3.2.</strong> Running in a Container</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../deploy/DockerDeploy.html"><strong aria-hidden="true">3.2.1.</strong> Docker Example</a></li><li class="chapter-item expanded "><a href="../deploy/Kubernetes.html"><strong aria-hidden="true">3.2.2.</strong> Deploying to Kubernetes</a></li></ol></li><li class="chapter-item expanded "><a href="../deploy/systemd.html"><strong aria-hidden="true">3.3.</strong> Running with Systemd</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Part II - Working with Your Robot</li><li class="chapter-item expanded "><a href="../Basics.html"><strong aria-hidden="true">4.</strong> Robot Basics</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../basics/ping.html"><strong aria-hidden="true">4.1.</strong> Addressing your Robot</a></li><li class="chapter-item expanded "><a href="../basics/matching.html"><strong aria-hidden="true">4.2.</strong> Command Matching</a></li><li class="chapter-item expanded "><a href="../basics/channels.html"><strong aria-hidden="true">4.3.</strong> Availability by Channel</a></li><li class="chapter-item expanded "><a href="../basics/help.html"><strong aria-hidden="true">4.4.</strong> The built-in Help System</a></li><li class="chapter-item expanded "><a href="../basics/stdplugins.html"><strong aria-hidden="true">4.5.</strong> Standard Commands</a></li><li class="chapter-item expanded "><a href="../basics/context.html"><strong aria-hidden="true">4.6.</strong> Context</a></li></ol></li><li class="chapter-item expanded "><a href="../Admin.html"><strong aria-hidden="true">5.</strong> Managing Your Robot</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../usage/update.html"><strong aria-hidden="true">5.1.</strong> Updating from Git</a></li><li class="chapter-item expanded "><a href="../extensiondev/devenv.html"><strong aria-hidden="true">5.2.</strong> Container Dev Environment</a></li><li class="chapter-item expanded "><a href="../extensiondev/local.html"><strong aria-hidden="true">5.3.</strong> Local Install Dev Environment</a></li><li class="chapter-item expanded "><a href="../extensiondev/CLI.html"><strong aria-hidden="true">5.4.</strong> CLI Operation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../extensiondev/secrets.html"><strong aria-hidden="true">5.4.1.</strong> Encrypting Secrets</a></li></ol></li><li class="chapter-item expanded "><a href="../extensiondev/terminal.html"><strong aria-hidden="true">5.5.</strong> Using the Terminal Connector</a></li><li class="chapter-item expanded "><a href="../usage/admin.html"><strong aria-hidden="true">5.6.</strong> Administrator Commands</a></li><li class="chapter-item expanded "><a href="../usage/logging.html"><strong aria-hidden="true">5.7.</strong> Logging</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Part III - Worked Examples</li><li class="chapter-item expanded "><a href="../customizing/first-plugin.html"><strong aria-hidden="true">6.</strong> Writing Your First Plugin</a></li><li class="chapter-item expanded "><a href="../customizing.html"><strong aria-hidden="true">7.</strong> Writing Custom Extensions for Your Robot</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../customizing/style.html"><strong aria-hidden="true">7.1.</strong> Style Guide</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../customizing/syntax-help.html"><strong aria-hidden="true">7.1.1.</strong> Help for Invalid Command Syntax</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../pipelines/integrations.html"><strong aria-hidden="true">8.</strong> Gopherbot Tool Integrations</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../pipelines/ssh.html"><strong aria-hidden="true">8.1.</strong> Integrating with SSH</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Part IV - Reference</li><li class="chapter-item expanded "><a href="../Configuration.html"><strong aria-hidden="true">9.</strong> Gopherbot Configuration Reference</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../config/file.html"><strong aria-hidden="true">9.1.</strong> Configuration File Loading</a></li><li class="chapter-item expanded "><a href="../config/job-plug.html"><strong aria-hidden="true">9.2.</strong> Job and Plugin Configuration</a></li><li class="chapter-item expanded "><a href="../config/troubleshooting.html"><strong aria-hidden="true">9.3.</strong> Troubleshooting</a></li></ol></li><li class="chapter-item expanded "><a href="../api/API-Introduction.html"><strong aria-hidden="true">10.</strong> Gopherbot Scripting API</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Environment-Variables.html"><strong aria-hidden="true">10.1.</strong> Script Environment Variables</a></li><li class="chapter-item expanded "><a href="../api/Languages.html"><strong aria-hidden="true">10.2.</strong> Language Templates</a></li><li class="chapter-item expanded "><a href="../api/Attribute-Retrieval-API.html"><strong aria-hidden="true">10.3.</strong> Attribute Retrieval</a></li><li class="chapter-item expanded "><a href="../api/Brain-API.html"><strong aria-hidden="true">10.4.</strong> Brain Methods</a></li><li class="chapter-item expanded "><a href="../api/Message-Sending-API.html"><strong aria-hidden="true">10.5.</strong> Message Sending</a></li><li class="chapter-item expanded "><a href="../api/Pipeline-API.html"><strong aria-hidden="true">10.6.</strong> Pipeline Construction</a></li><li class="chapter-item expanded "><a href="../api/Response-Request-API.html"><strong aria-hidden="true">10.7.</strong> Requesting Responses</a></li><li class="chapter-item expanded "><a href="../api/Utility-API.html"><strong aria-hidden="true">10.8.</strong> Utility</a></li></ol></li><li class="chapter-item expanded "><a href="../pipelines/jobspipes.html"><strong aria-hidden="true">11.</strong> Pipelines, Plugins, Jobs and Tasks</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../pipelines/primary.html"><strong aria-hidden="true">11.1.</strong> The Primary Pipeline</a></li><li class="chapter-item expanded "><a href="../pipelines/final.html"><strong aria-hidden="true">11.2.</strong> The Final Pipeline</a></li><li class="chapter-item expanded "><a href="../pipelines/fail.html"><strong aria-hidden="true">11.3.</strong> The Fail Pipeline</a></li><li class="chapter-item expanded "><a href="../pipelines/TaskEnvironment.html" class="active"><strong aria-hidden="true">11.4.</strong> Task Environment Variables</a></li><li class="chapter-item expanded "><a href="../pipelines/tasks.html"><strong aria-hidden="true">11.5.</strong> All Included Tasks</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Appendix</li><li class="chapter-item expanded "><a href="../appendices/Appendix.html"><strong aria-hidden="true">12.</strong> Appendix</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../appendices/InstallArchive.html"><strong aria-hidden="true">12.1.</strong> A - Gopherbot Install Archive</a></li><li class="chapter-item expanded "><a href="../appendices/Protocols.html"><strong aria-hidden="true">12.2.</strong> B - Protocols</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../appendices/slack.html"><strong aria-hidden="true">12.2.1.</strong> B.1 - Slack</a></li><li class="chapter-item expanded "><a href="../appendices/rocket.html"><strong aria-hidden="true">12.2.2.</strong> B.2 - Rocket.Chat</a></li><li class="chapter-item expanded "><a href="../appendices/terminal.html"><strong aria-hidden="true">12.2.3.</strong> B.3 - Terminal</a></li><li class="chapter-item expanded "><a href="../appendices/testproto.html"><strong aria-hidden="true">12.2.4.</strong> B.4 - Test</a></li><li class="chapter-item expanded "><a href="../appendices/nullconn.html"><strong aria-hidden="true">12.2.5.</strong> B.5 - Nullconn</a></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Gopherbot DevOps Chatbot</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <blockquote>
<p>Note on Parameters and Environment Variables: The <strong>Gopherbot</strong> documentation uses <em>environment variable</em> and <em>parameter</em> somewhat interchangeably; this is due to configured and set parameters being made available to external scripts as environment variables.</p>
</blockquote>
<h1 id="task-environment-variables"><a class="header" href="#task-environment-variables">Task Environment Variables</a></h1>
<p>Each time a task is run, a custom environment is generated for that task. For external tasks such as <code>ssh-init</code>, these values are actually set as environment variables for the process. <em>Go</em> tasks access these values with the <code>GetParameter()</code> API call.</p>
<p>The precedence of environment variables seen by a given task is determined by the algorithm in <code>bot/run_pipelines.go:getEnvironment()</code>. The various environment sources are listed here, in order from lowest to highest priority.</p>
<h2 id="namespace-parameters"><a class="header" href="#namespace-parameters">NameSpace Parameters</a></h2>
<p>Various tasks, plugins and jobs can be configured to share parameters by defining <code>NameSpaces</code> in <code>conf/robot.yaml</code>, and setting the <code>NameSpace</code> parameter for a given task to the shared namespace. For instance, the <code>ssh-init</code> task and <code>ssh-admin</code> plugin both get access to the <code>BOT_SSH_PHRASE</code> environment variable via the <code>ssh</code> namespace.</p>
<h2 id="task-parameters"><a class="header" href="#task-parameters">Task Parameters</a></h2>
<p>Individual tasks, plugins and jobs can also have <code>Parameters</code> defined. If present, these override any parameters set for a shared namespace.</p>
<h2 id="pipeline-parameters"><a class="header" href="#pipeline-parameters">Pipeline Parameters</a></h2>
<p>Any time a job is run, the parameters for that job (including those inherited from it's namespace, if any) initialize the environment variables for the pipeline as a whole, and are available to all tasks in the pipeline. Parameters set in the pipeline override task and namespace parameters for any tasks run in the pipeline, allowing specific job parameters to override defaults for the task.</p>
<h3 id="plugins-and-pipelines"><a class="header" href="#plugins-and-pipelines">Plugins and Pipelines</a></h3>
<p>Plugins can also start a new pipeline, but plugin parameters are not automatically added to the pipeline. Plugins can, however, explicity publish parameters to the pipeline with the <code>SetParameter()</code> API call.</p>
<p>Plugin tasks can also be added to a pipeline with the <code>AddCommand()</code>, <code>FinalCommand()</code> and <code>FailCommand()</code> API calls. Unlike tasks, plugins only inherit parameters from the pipeline when they are configured with <code>Privileged: true</code> in <code>robot.yaml</code>.</p>
<h2 id="repository-parameters"><a class="header" href="#repository-parameters">Repository Parameters</a></h2>
<p>If a given Job calls the <code>ExtendNamespace()</code> API to start a build, the parameters for that repository set in <code>conf/repositories.yaml</code> overwrite any values in the current pipeline, which then behave as <strong>Pipeline Parameters</strong> as above.</p>
<h2 id="setparameter"><a class="header" href="#setparameter">SetParameter()</a></h2>
<p>Parameters set with the <code>SetParameter()</code> API call overwrite the current value for a pipeline. Parameters set with <code>SetParameter()</code> have the highest priority, and will always apply to later tasks in the pipeline.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../pipelines/fail.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../pipelines/tasks.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../pipelines/fail.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../pipelines/tasks.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
