<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>All Included Tasks - Gopherbot DevOps Chatbot</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Gopherbot DevOps Chatbot</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="included-tasks"><a class="header" href="#included-tasks">Included Tasks</a></h1>
<blockquote>
<p>NOTE: This section is incomplete!</p>
</blockquote>
<p><strong>Gopherbot</strong> ships with a selection of available pipeline tasks, listed here alphabetically. Note that the given examples use <strong>bash</strong> syntax for simplicity; for <strong>ruby</strong> and <strong>python</strong> see the chapter on the <a href="../api/API-Introduction.html">Gopherbot API</a>.</p>
<hr />
<p><strong>email-log</strong> - <em>privileged</em></p>
<p>Usage:</p>
<ul>
<li><code>FinalTask email-log joe@example.com emily@example.com frank bob</code></li>
<li><code>FinalTask email-log</code></li>
</ul>
<p>Normally used in the <strong>fail</strong> and <strong>final</strong> pipelines, emails a copy of the pipeline log. Can also be used with <code>AddTask</code> in the main pipeline, but content will be incomplete.</p>
<p><em>Notes on the current implementation:</em><br />
The email function call takes a byte slice for the email body, rather than an <code>io.Reader</code>, meaning the entire body of the message is read in to memory. To limit memory use, <strong>Gopherbot</strong> allocates a 10MB line-based circular buffer, with maximum 16KB-long lines (terminated by <code>\n</code>), and reads the log to that buffer for emailing. Logs that are longer than 10MB will only send the last 10MB of the log, and lines longer than 16KB will be truncated.</p>
<hr />
<p><strong>pause-brain</strong> - <em>privileged</em></p>
<p>Usage: <code>AddTask pause-brain</code></p>
<p>Pause brain operations for backups and restores. After half a minute, the brain automatically resumes; best practice is to add <code>resume-brain</code> after the backup/restore task.</p>
<hr />
<p><strong>pause-brain</strong></p>
<p>Usage: <code>AddTask pause &lt;seconds&gt;</code></p>
<p>Causes the pipeline to pause for a number of seconds before proceeding to the next task. Useful when triggering an external process that there's no easy way to poll for completion.</p>
<hr />
<p><strong>restart-robot</strong> - <em>privileged</em></p>
<p>Usage: <code>AddTask restart-robot</code></p>
<p>Allow a privileged pipeline to queue a restart of the robot after the pipeline completes. Heavily used by bootstrap and setup plugins. <strong>NOTE:</strong> This behavior means that tasks added after <strong>restart-robot</strong> are actually completed <em>before</em> the restart. In practice, the current pipeline will change the state of the robot, and after restarting a plugin <strong>init</strong> function will check for the state change (e.g. presence of <code>.restore</code> file) and start a new pipeline.</p>
<hr />
<p><strong>resume-brain</strong> - <em>privileged</em></p>
<p>Usage: <code>AddTask resume-brain</code></p>
<p>Resume brain functions after backup/restore.</p>
<hr />
<p><strong>robot-quit</strong> - <em>privileged</em></p>
<p>Usage: <code>AddTask robot-quit</code></p>
<p>Special purpose task; once called, the robot will exit as soon as all pipelines have completed, and not allow new pipelines to start.</p>
<hr />
<p><strong>rotate-log</strong> - <em>privileged</em></p>
<p>Usage: <code>AddTask rotate-log &lt;extension&gt;</code></p>
<p>Useful for e.g. nightly log rotation jobs, when the robot has been started with e.g.: <code>gopherbot -d -l robot.log</code>. For example:</p>
<pre><code>AddTask rotate-log "log.$(date +%a)"
</code></pre>
<p>This would keep daily logs of the form <code>robot.log.Mon</code>, etc.</p>
<hr />
<p><strong>send-message</strong></p>
<p>Usage: <code>AddTask send-message &lt;str&gt; (...)</code></p>
<p>Have the robot send a message in the channel, normally to report status of a build. Can be a single long string, or multiple strings; in the case of multiple strings they will be joined with a space separator.</p>
<hr />
<p><strong>ssh-agent</strong> - <em>privileged</em></p>
<p>Usage:</p>
<ul>
<li><code>AddTask ssh-agent start &lt;path/to/key&gt; &lt;timeout&gt;</code> - requires <code>BOT_SSH_PHRASE</code> in parameters</li>
<li><code>AddTask ssh-agent stop</code> - uses <code>_SSH_AGENT_HANDLE</code>, automatically added as <code>FinalTask</code> by start, deploy</li>
<li><code>AddTask ssh-agent deploy &lt;timeout&gt;</code> - requires <code>GOPHER_DEPLOY_KEY</code> in parameters</li>
</ul>
<p>The <code>ssh-agent</code> task uses Go ssh-agent libraries to start a new Goroutine loaded with a deployment key, or regular encrypted key. The <code>start</code> and <code>deploy</code> sub-commands automatically add a <code>FinalTask ssh-agent stop</code> to the pipeline to ensure cleanup. This task can be used with <code>ssh-git-helper</code> and <code>git-command</code> to work with git repositories.</p>
<p>The <code>start</code> and <code>deploy</code> sub-commands also create a socket in <code>$GOPHER_HOME</code> and sets the <code>SSH_AUTH_SOCK</code> parameter in the pipeline, so e.g. a "bash" task could use native ssh commands.</p>
<p>See also:</p>
<ul>
<li>plugins/samples/bootstrap.py - previous bootstrapping pipeline</li>
</ul>
<hr />
<p><strong>ssh-git-helper</strong> - <em>privileged</em></p>
<p>Usage:</p>
<ul>
<li><code>AddTask ssh-git-helper addhostkeys &lt;encoded-host-keys&gt;</code> - create a <code>known_hosts</code> file from the encoded keys</li>
<li><code>AddTask ssh-git-helper scan &lt;host&gt;</code> - fallback sub-command to scan a remote host for the host keys</li>
<li><code>AddTask ssh-git-helper loadhostkeys &lt;repo uri&gt;</code> - for github, bitbucket, retrieve host keys from a known https API endpoint</li>
<li><code>AddTask ssh-git-helper publishenv</code> - set <code>SSH_OPTIONS</code> and <code>GIT_SSH_COMMAND</code> for external binary use</li>
<li><code>AddTask ssh-git-helper delete</code> - delete the temporary hostkeys file; automatically added as a FinalTask</li>
</ul>
<p>The <code>addhostkeys</code>, <code>loadhostkeys</code> and <code>scan</code> sub-commands all create a <code>known_hosts</code> file that can be used with <code>git-command</code> and <code>ssh-agent</code> for working with git repositories authenticated with ssh. Each of these sub-commands also automatically adds a <code>FinalTask ssh-git-helper delete</code> to remove the temporary file. By using <code>publishenv</code>, the <code>SSH_OPTIONS</code> and <code>GIT_SSH_COMMAND</code> parameters (environment variables) are exported to the pipeline for use by e.g. bash-based tasks using the system ssh and/or git binaries.</p>
<p>Note that <code>&lt;encoded-host-keys&gt;</code> is a single-line string encoded similarly to <code>GOPHER_DEPLOY_KEY</code>; all spaces are replaced with '_', and newlines are replaced with ':'; basically, <code>tr ' \n' '_:'</code>.</p>
<hr />
<p><strong>git-command</strong> - <em>privileged</em></p>
<p>Usage:</p>
<ul>
<li><code>AddTask git-command clone &lt;repoURL&gt; &lt;branch&gt; &lt;directory&gt;</code> - Clones a repository from <code>&lt;repoURL&gt;</code> into <code>&lt;directory&gt;</code>. If <code>&lt;branch&gt;</code> is specified, it clones that branch; otherwise, it clones the default branch.</li>
<li><code>AddTask git-command pull &lt;directory&gt;</code> - Pulls the latest changes in the repository located at <code>&lt;directory&gt;</code>.</li>
<li><code>AddTask git-command checkout &lt;branch&gt; &lt;directory&gt;</code> - Switches to <code>&lt;branch&gt;</code> in the repository at <code>&lt;directory&gt;</code>. If the branch does not exist locally, it creates it to track the remote branch.</li>
<li><code>AddTask git-command push &lt;branch-if-no-upstream&gt; &lt;commit_msg&gt; &lt;directory&gt;</code> - Commits and pushes changes in the repository at <code>&lt;directory&gt;</code>. If the current branch has no upstream, it pushes to <code>origin/&lt;branch-if-no-upstream&gt;</code> with the provided <code>&lt;commit_msg&gt;</code>; otherwise, it pushes to the tracked remote branch.</li>
</ul>
<p>The <code>git-command</code> task provides essential Git operations within the pipeline, enabling actions such as cloning repositories, pulling updates, checking out branches, and pushing changes. It is designed for straightforward, non-development workflows to support regular robot operations without the complexity of full Git functionalities.</p>
<p>This task integrates seamlessly with the <code>ssh-agent</code> and <code>ssh-git-helper</code> tasks to manage SSH authentication and host key verification, ensuring secure interactions with Git repositories.</p>
<p><strong>See also:</strong></p>
<ul>
<li>plugins/samples/save.sh - previous job for pushing code to remote git repos</li>
</ul>
<hr />
<p><strong>tail-log</strong></p>
<p>Usage: <code>AddTask tail-log</code> or <code>FailTask tail-log</code></p>
<p>Dump the last 2k chars (in even line increments) to the channel. Normally this is used as a <code>FailTask</code> to show the source of the failure.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../pipelines/TaskEnvironment.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../appendices/Appendix.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../pipelines/TaskEnvironment.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../appendices/Appendix.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
